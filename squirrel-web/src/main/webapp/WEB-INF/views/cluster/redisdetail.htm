<div class="main-content" style="opacity: 1.0;"
     ng-controller="RedisController">
    <div class=" main-content-inner">
        <script type="text/javascript"
                src="${rc.contextPath}/static/js/highcharts/highcharts.js"></script>
        <script type="text/javascript"
                src="${rc.contextPath}/static/js/highcharts/highcharts-more.js"></script>
        <script type="text/javascript"
                src="${rc.contextPath}/static/js/highcharts/solid-gauge.js"></script>
        <script type="text/javascript"
                src="${rc.contextPath}/static/js/redis/redisdetail.js"></script>
        <style>
            th{
               font-size: 14px;  color: #404040;
            }
        </style>
        <div class="page-content">
            <div class="page-header">
                <h1>集群
                    <i class="ace-icon fa fa-angle-double-right"></i>
                    Redis  <i class="ace-icon fa fa-angle-right"></i>
                    {{redisData.clusterName}}
                </h1>
            </div>

            <div class="row">
                <h4 class="header blue">性能概览</h4>
                <div style="width: 600px; height: 200px; margin: 0 auto">
                    <div id="container-memory" style="width: 300px; height: 200px; float: left">
                    </div>
                     <div id="container-qps" style="width: 300px; height: 200px; float: left"></div>
                    </div>
                <h4 class="header blue">节点信息</h4>
                <div class="row">
                    <div class="">
                        <table class="table table-striped table-hover" style="margin-left: 10px">
                            <thead>
                            <tr>
                                <th style="width: 5%">ID</th>
                                <th style="width: 25%">Master</th>
                                <th style="width: 20%">Slave</th>
                                <th style="width: 20%">内存</th>
                                <th style="width: 10%">Slots</th>
                                <th style="width: 20%">操作</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat = "data in redisData.nodes">
                                <td>{{$index+1}}</td>
                                <td>{{data.master.address}}
                                    <span ng-show="data.master.migrating"><i class="ace-icon fa fa-cloud-upload bigger-130"></i></span>
                                </td>
                                <td>{{data.slave.address}}</td>
                                <td>{{data.master.info.used}}%/{{data.master.info.maxMem}}G</td>
                                <td>{{data.master.slotSize}}</td>
                                <td>
                                    <div class="hidden-sm hidden-xs action-buttons">
                                        <a class="grey" href="#reshardModal" data-toggle="modal">
                                            <i class="ace-icon fa fa-share bigger-130"></i>
                                        </a>

                                        <a class="grey" href="#">
                                            <i class="ace-icon fa fa-exchange bigger-130"></i>
                                        </a>
                                        <a class="grey" href="#" ng-show="{{data.slave.address==null}}">
                                            <i class="ace-icon bigger-130"> S+ </i>
                                        </a>
                                        <a class="grey" href="#" ng-show="{{data.slave.address!=null}}">
                                            <i class="ace-icon bigger-130"> S- </i>
                                        </a>

                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <h4 class="header blue">Category信息</h4>


            </div>
        </div>

    </div>

    <div class="modal fade" id="reshardModal" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Slot迁移</h4>
                </div>
                <div class="modal-body">
                    <form method="post"
                          class="form-horizontal bs-example bs-example-form" role="form"
                          name="myForm" ng-submit="reshard()">
                        <div class="input-group col-xs-12"  ng-switch="reshardType">
                            <div class="col-xs-12 form-group">
                                <label class="col-xs-3 control-label control-label no-padding-right">1.选择迁移模式</label>
                                <div class="col-xs-9">
                                    <select class="col-xs-12" ng-model="reshardType"
                                            name="type"required>
                                        <option value="average">配平</option>
                                        <option value="export">导出</option>
                                    </select>
                                    <span ng-switch-when="average">(注:配平模式下将平衡所选实例的slot)</span>
                                    <span ng-switch-when="export">(注:导出模式下会把选中源实例中所有的slot导出)</span>
                                </div>
                            </div>
                            <div class="space-4"></div>
                            <div class="col-xs-12 form-group" ng-switch-when="average">
                                <label class="col-xs-3 control-label control-label no-padding-right">2.选择实例：</label>
                                <div class="col-xs-9">
                                    <table class="table" id="avgTable">
                                        <thead >
                                        <tr >
                                            <th class="center">
                                                <label class="position-relative">
                                                    <input type="checkbox" class="ace"/>
                                                    <span class="lbl"></span>
                                                </label>
                                            </th>
                                            <th>Address</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="address in redisData.nodes">
                                            <td class="center">
                                                <label class="position-relative">
                                                    <input type="checkbox" class="ace" />
                                                    <span class="lbl"></span>
                                                </label>
                                            </td>
                                            <td>
                                                <a>{{address.master.address}} slots : {{address.master.slotSize}}</a>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-xs-12 form-group" ng-switch-when="export">
                                <label class="col-xs-3 control-label control-label no-padding-right">1.选择源实例：</label>
                                <div class="col-xs-9">
                                    <table class="table" id="srcTable">
                                        <thead >
                                            <tr >
                                                <th class="center">
                                                    <label class="position-relative">
                                                        <input type="checkbox" class="ace"/>
                                                        <span class="lbl"></span>
                                                    </label>
                                                </th>
                                                <th>Address</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="address in redisData.nodes">
                                                <td class="center">
                                                    <label class="position-relative">
                                                        <input type="checkbox" class="ace" />
                                                        <span class="lbl"></span>
                                                    </label>
                                                </td>
                                                <td>
                                                    <a>{{address.master.address}} slots : {{address.master.slotSize}}</a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                                <br>
                                <label class="col-xs-3 control-label control-label no-padding-right">2.选择目标实例：</label>
                                <div class="col-xs-9">
                                    <table class="table" id="desTable">
                                        <thead >
                                        <tr >
                                            <th class="center">
                                                <label class="position-relative">
                                                    <input type="checkbox" class="ace"/>
                                                    <span class="lbl"></span>
                                                </label>
                                            </th>
                                            <th>Address</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="address in redisData.nodes">
                                            <td class="center">
                                                <label class="position-relative">
                                                    <input type="checkbox" class="ace" />
                                                    <span class="lbl"></span>
                                                </label>
                                            </td>
                                            <td>
                                                <a>{{address.master.address}} slots : {{address.master.slotSize}}</a>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="control-group" style="margin-top: 20px;text-align: center;">
                                <div class="controls">
                                    <button type="button" class="btn btn-default"
                                            data-dismiss="modal">关闭
                                    </button>
                                    <button type="submit" class="btn btn-success">提交</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--/.modal-content-->
    </div>

</div>
<script type="application/javascript">
    $(document).on('click', 'th input:checkbox' , function(){
        var that = this;
        $(this).closest('table').find('tr > td:first-child input:checkbox')
                .each(function(){
                    this.checked = that.checked;
                    $(this).closest('tr').toggleClass('selected');
                });
    });
</script>